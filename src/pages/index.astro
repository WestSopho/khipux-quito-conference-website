---
import "../styles/global.css";
import NavbarDesktop from "../components/NavbarDesktop.astro";
import NavbarMobile from "../components/NavbarMobile.astro";
import Hero from "../components/Hero.astro";
import AboutEvent from "../components/AboutEvent.astro";
import ProgramOverview from "../components/ProgramOverview.astro";
import ParticipationImpact from "../components/ParticipationImpact.astro";
import ApplyToParticipate from "../components/ApplyToParticipate.astro";
import Speakers from "../components/Speakers.astro";
import Partners from "../components/Partners.astro";
import Venue from "../components/Venue.astro";
import Footer from "../components/Footer.astro";
import CookieConsent from "../components/CookieConsent.astro";
import DeadlineExtensionModal from "../components/DeadlineExtensionModal.astro";

// Import hero images for preload
import heroMobile from "../assets/hero-image-mobile.webp";
---

<!doctype html>
<html lang="en">
  <head>
    <!-- Google Analytics -->
    <script
      is:inline
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-6W08KJNTKS"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-6W08KJNTKS");
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Preconnect to external origins for faster resource loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Preload LCP hero image for mobile -->
    <link
      rel="preload"
      as="image"
      href={heroMobile.src}
      type="image/webp"
      media="(max-width: 767px)"
      fetchpriority="high"
      imagesrcset={`${heroMobile.src} 640w`}
      imagesizes="100vw"
    />

    <!-- Optimized font loading with display=swap for better CLS -->
    <link
      rel="preload"
      as="style"
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,600&display=swap"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,600&display=swap"
      media="print"
      onload="this.media='all'"
    />
    <noscript>
      <link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,400;0,500;0,600;0,700;0,800;1,400;1,600&display=swap"
      />
    </noscript>
    
    <!-- Font fallback to reduce CLS -->
    <style>
      @font-face {
        font-family: 'Montserrat Fallback';
        font-style: normal;
        font-weight: 400;
        src: local('Arial');
        ascent-override: 104%;
        descent-override: 28%;
        line-gap-override: 0%;
        size-adjust: 95%;
      }
    </style>

    <link
      rel="icon"
      type="image/png"
      href={`${import.meta.env.BASE_URL}favicon.png`}
    />

    <!-- SEO Meta Tags -->
    <meta
      name="description"
      content="KHIPUx Quito 2026 - Democratizing AI in Bioimage and Medical Imaging. Join us February 23-25, 2026 for this groundbreaking conference on artificial intelligence in biomedical imaging."
    />
    <meta
      name="keywords"
      content="KHIPUx, Quito, AI, artificial intelligence, bioimage, medical imaging, conference, 2026, machine learning, deep learning"
    />
    <meta name="author" content="KHIPU" />

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="KHIPUx Quito 2026 - AI in Bioimage & Medical Imaging"
    />
    <meta
      property="og:description"
      content="Join us February 23-25, 2026 for a groundbreaking conference on democratizing AI in bioimage and medical imaging."
    />
    <meta property="og:locale" content="en_US" />
    <meta
      property="og:image"
      content="https://biodecodinglab.github.io/khipux-quito-conference-website/og-image.png"
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta
      property="og:url"
      content="https://biodecodinglab.github.io/khipux-quito-conference-website/"
    />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="KHIPUx Quito 2026" />
    <meta
      name="twitter:image"
      content="https://biodecodinglab.github.io/khipux-quito-conference-website/og-image.png"
    />
    <meta
      name="twitter:description"
      content="Democratizing AI in Bioimage and Medical Imaging - February 23-25, 2026"
    />

    <meta name="generator" content={Astro.generator} />
    <title>
      KHIPUx Quito 2026 - Democratizing AI in Bioimage & Medical Imaging
    </title>
  </head>
  <body class="bg-khipu-black font-montserrat">
    <!-- Container -->
    <div class="mx-auto flex min-h-screen flex-col">
      <NavbarDesktop />
      <NavbarMobile />
      <Hero />
      <AboutEvent />
      <Speakers />
      <ProgramOverview />
      <ParticipationImpact />
      <ApplyToParticipate />
      <Partners />
      <Venue />
      <Footer />
    </div>
    <CookieConsent />
    <DeadlineExtensionModal />

    <!-- Google Analytics Custom Event Tracking -->
    <script is:inline>
      // Track important button clicks for CV metrics
      document.addEventListener("DOMContentLoaded", function () {
        // Hero "Apply Now" button click
        const heroApplyBtn = document.getElementById("hero-apply-btn");
        if (heroApplyBtn) {
          heroApplyBtn.addEventListener("click", function () {
            if (typeof gtag !== "undefined") {
              gtag("event", "cta_click", {
                event_category: "engagement",
                event_label: "Hero Apply Now Button",
                value: 1,
              });
            }
          });
        }

        // Hero "Program Overview" button click
        const heroProgramBtn = document.getElementById("hero-program-btn");
        if (heroProgramBtn) {
          heroProgramBtn.addEventListener("click", function () {
            if (typeof gtag !== "undefined") {
              gtag("event", "cta_click", {
                event_category: "engagement",
                event_label: "Hero Program Overview Button",
                value: 1,
              });
            }
          });
        }

        // Main "Apply Now" button (CONVERSION - most important!)
        const mainApplyBtn = document.getElementById("main-apply-btn");
        if (mainApplyBtn) {
          mainApplyBtn.addEventListener("click", function () {
            if (typeof gtag !== "undefined") {
              gtag("event", "generate_lead", {
                event_category: "conversion",
                event_label: "Application Form Click",
                value: 100,
              });
            }
          });
        }

        // Track section views (when sections come into viewport)
        const sections = ["about", "speakers", "schedule", "register"];
        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting && typeof gtag !== "undefined") {
                gtag("event", "section_view", {
                  event_category: "engagement",
                  event_label: entry.target.id + " section viewed",
                });
                observer.unobserve(entry.target); // Only track once per session
              }
            });
          },
          { threshold: 0.5 },
        );

        sections.forEach((sectionId) => {
          const section = document.getElementById(sectionId);
          if (section) observer.observe(section);
        });
      });
    </script>

    <!-- Expired Deadline State Handler -->
    <script is:inline>
      // Global handler for expired deadline state
      function handleExpiredDeadline() {
        // Update Hero section
        const heroDeadlineBox = document.getElementById("hero-deadline-box");
        if (heroDeadlineBox) {
          heroDeadlineBox.innerHTML =
            '<span class="text-khipu-white text-center font-semibold">Applications are closed. Thanks for applying!</span>';
          heroDeadlineBox.classList.add("justify-center");
        }

        // Remove Hero Apply button from DOM
        const heroApplyBtn = document.getElementById("hero-apply-btn");
        if (heroApplyBtn) {
          heroApplyBtn.remove();
        }

        // Update Apply section
        const applyDeadlineBanner = document.getElementById(
          "apply-deadline-banner",
        );
        if (applyDeadlineBanner) {
          applyDeadlineBanner.innerHTML =
            '<p class="text-khipu-white text-center text-xl font-semibold md:text-2xl">Applications are closed. Thank you for your interest!</p>';
        }

        // Remove Apply section button from DOM
        const mainApplyBtn = document.getElementById("main-apply-btn");
        if (mainApplyBtn) {
          mainApplyBtn.remove();
        }
      }

      // Check on page load
      // Deadline: Feb 5, 2026 00:00:00 Quito Time (ECT/UTC-5) = Feb 5, 2026 05:00:00 UTC
      const deadline = new Date("2026-02-05T05:00:00Z").getTime();
      if (new Date().getTime() > deadline) {
        handleExpiredDeadline();
      }

      // Listen for countdown expiry event
      window.addEventListener("deadlineExpired", handleExpiredDeadline);
    </script>
  </body>
</html>
